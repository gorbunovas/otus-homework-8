## User story
### Регистрация клиента
1. Пользователь интернет магазина должен иметь возможность зарегистрироваться в нём через механизм логин/пароль или внешние сервисы (гугл, майкрософт, яндекс, т.д.)
### Аутентификация клиента и администратора
1. Пользователь должен иметь ограниченные права на управление магазином:
  + возможность пополнять свой кошелёк
  + проверять свой баланс на кошельке
  + производить поиск товара
  + добавлять товар в корзину
  + осуществлять покупку с помощью кошелька
  + получать товар на указанный адрес
  + смотреть историю заказов
2. Аутентифицированный администратор:
  + добавлять новый товар в «витрину» интернет-магазина
  + получать информацию о заказах пользователя
### Пополнение кошелька
1. Пользователь должен иметь возможность пополнять кошелёк.
2. Пользователь должен иметь возможность смотреть остаток средств на кошельке
### Выбор товара
1. Пользователь должен иметь возможность фильтровать товар по категориям
2. Пользователь должен иметь возможность искать товар по наименованию
3. Возвращаться пользователю должен не весь список товаров, а первые 20 штук, остальные появляются при пролистывании страниц (paging)
#### Покупка товара
1. Пользователь должен иметь возможность купить товар, оплатив его из средств своего кошелька
### Доставка товара
1. Пользователь должен иметь возможность указать куда ему доставить товар
2. Пользователь должен иметь возможность воспользоваться самовывозом со склада
### Нотификация
1. Пользователь должен получать нотификацию о состояние заказа
2. Пользователь должен иметь возможность посмотреть историю нотификаций
### История заказов
1. Пользователь должен иметь возможность получать историю своих заказов
2. Администратор должен иметь возможность получать историю всех заказов
### Добавление товара на склад
1. Администратор должен иметь возможность добавлять и удалять товар в магазине
### Выход из приложения
1. Как зарегистрированный пользователь я хочу иметь возможность выйти из приложения, чтобы воспользоваться другим аккаунтом.

## Описание сервисов

### Auth server
 - Регистрация клиента
 - Выдача токена клиенту
 - Валидация токенов

### User service
 - Создание учётную запись клиента
 - Редактирование профиля клиента
 - Создание кошелька в сервисе Billing

### Order (orchestrator)
1. Управление бизнес-процессом заказа товаров
   * Вызывает сервис Billing для оплаты товара
   * Бронирует товар в сервисе Storehouse
   * Создаёт задачу курьерам на доставку в сервисе Delivery
   * Осуществляет отказ транзакций в случае ошибки бронирования или оплаты
   * Отправляет нотификации клиентам о статусе заказа в сервис Notification
2. Запрос истории заказов 
3. Запрос статуса заказа

### Storehouse
- Бронирование товара
- Снятие брони с товара
- Увеличение/уменьшение количества товаров

### Billing
- Пополнение баланса
- Оплата товара
- Хранение истории транзакций

### Delivery
- Ставит товары в очередь доставки

### Notification
- Ставит нотификации в очередь отправки
- Отправляет сообщение в провайдер нотификации

## Архитектура. Вариант 1 Оркестрация
![scheme1](diagram/otus.%20orchestrator.png)

Бизнес-процесс (зеленые стрелки) заказа товара осуществляется сервисом оркестратором Order

## Архитектура Вариант 2 Хореография
![scheme2](diagram/Otus.%20Choregrafy.png)

Бизнес-процесс (желтые стрелки) заказа товара осуществляется с помощью хореографии

## Возможные дополнительные доработки
- Внедрение брокера Kafka для сервисов Notification и Delivery
- Замена auth server на Keycloak для возможности регистрации пользователей с помощью сторонних OAuth провайдеров
- Внедрение Elastic для полнотекстового поиска товаров
- Внедрение istio для реализации паттернов rate limit, circus breaker, canary деплоя на каждом сервисе, шифрование трафика между сервисами
